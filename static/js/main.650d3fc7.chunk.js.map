{"version":3,"sources":["App.js","index.js"],"names":["batTreeCharacteristic","BatMachine","BatState","numPatterns","currentPattern","numAnimations","currentAnimation","Header","props","title","this","React","Component","App","onClickConnect","bind","handleChangeBlah","makePatButton","makeAniButton","state","connected","allPatterns","allAnimations","filters","push","name","optionalServices","console","log","options","JSON","stringify","navigator","bluetooth","requestDevice","then","device","gatt","connect","server","getPrimaryService","service","getCharacteristic","characteristic","addEventListener","startNotifications","setState","writeValueWithoutResponse","TextEncoder","encode","catch","error","event","respStr","String","fromCharCode","apply","Uint8Array","target","value","buffer","parseInt","localPatterns","index","allPaterns","queryString","localAnimations","data","idx","id","onClick","e","className","map","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.650d3fc7.chunk.js","sourcesContent":["import React from \"react\"\nimport './App.css';\n\nvar batTreeDevice;\nvar batTreeCharacteristic;\n\n// State machine\n// 1. Connect, and all that crap\n// 2. Query for number of patterns\n// 3. Gather all of the patterns, and print them\n// 4. Query for number of animations\n// 5. Gather all of the animations, and print them\n// 6. Hang out ready to rock!\n//    -- Open settings tab\n//    7. Query brightness\n//    8. Query volume\n//    9. Set brightness\n//    9a. Get brightness\n//    10. Set volume\n//    10a. Get volume\n// 11. Set pattern or animation\n// 12. Turn off the tree.\n\nconst BatMachine = {\n  connect : {\n    //nextState: queryNumPat\n  },\n  queryNumPat : {\n    //nextState : gatherPatterns\n  },\n  gatherPatterns : {\n    //nextState : queryNumAni\n  },\n  queryNumAni : {\n    //nextState : queryAnimations\n  },\n  gatherAnimations : {\n\n  },\n  readyToRock : {\n\n  }\n}\n\nlet BatState = BatMachine.connect;\nlet numPatterns = 0;\nlet currentPattern = 0;\nlet numAnimations = 0;\nlet currentAnimation = 0;\n\n\nclass Header extends React.Component {\n  constructor(props) {\n    super(props);\n\n    // Set title property\n    this.title = props.title;\n  }\n\n  render() {\n    return (\n      <div>\n        <h1>{this.title}</h1>\n      </div>\n    )\n  }\n}\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n\n    // Set this binding\n    this.onClickConnect = this.onClickConnect.bind(this);\n    this.handleChangeBlah = this.handleChangeBlah.bind(this);\n    this.makePatButton = this.makePatButton.bind(this);\n    this.makeAniButton = this.makeAniButton.bind(this);\n\n    this.state = {\n      connected: false,\n      allPatterns: [],\n      allAnimations: []\n    }\n  }\n\n  onClickConnect() {\n    // Try to find the BAT Tree device\n    let filters = [];\n    filters.push({name: \"BAT Tree\"});\n    let optionalServices = ['0000ffe0-0000-1000-8000-00805f9b34fb'];\n    console.log(optionalServices);\n    let options = {};\n    options.filters = filters;\n    options.optionalServices = optionalServices;\n    console.log('Requesting Bluetooth Device...');\n    console.log('with ' + JSON.stringify(options));\n\n    // Request the device with the options\n    navigator.bluetooth.requestDevice(options)\n\n    // If success, connect to GATT server\n    .then(device => {\n      console.log('Connecting to GATT Server...');\n      batTreeDevice = device;\n      return batTreeDevice.gatt.connect();\n    })\n\n    // Grab the primary service for the BLE controller\n    .then(server => {\n      console.log('Getting Primary Service...');\n      return server.getPrimaryService(0xFFE0);\n    })\n\n    // Connect to the characteristic\n    .then(service => {\n      console.log('Getting Custom Characteristic...');\n      return service.getCharacteristic(0xFFE1);\n    })\n\n    // Register callback when connected to characteristic\n    .then(characteristic => {\n      console.log('We got all the way to the end!');\n      batTreeCharacteristic = characteristic;\n      batTreeCharacteristic.addEventListener('characteristicvaluechanged', this.handleChangeBlah);\n      batTreeCharacteristic.startNotifications();\n\n      //  Update the state so connect goes away\n      this.setState(() => {\n        return {\n          connected: true\n        }\n      })\n    })\n    .then(() => {\n      BatState = BatMachine.queryNumPat;\n      batTreeCharacteristic.writeValueWithoutResponse(new TextEncoder().encode('NumPat\\n'));\n    })\n    .catch(error => {\n      console.log('WRONG! ' + error);\n    });\n\n  }\n\n\n\n  \n  handleChangeBlah(event) {\n    let respStr = String.fromCharCode.apply(null, new Uint8Array(event.target.value.buffer));\n    if (respStr === \"EOE\") {\n      console.log(\"Let us ignore the EOE, shall we?\");\n      return;\n    }\n\n    if (BatState === BatMachine.queryNumPat) {\n      numPatterns = parseInt(respStr);\n      console.log('The number of patterns is ' + numPatterns);\n\n      // Now that we have the number of patterns, let's get them\n      if (numPatterns === 0) {\n        console.log('Uh... I guess I need to handle this. But for now, it will break me.');\n        return;\n      }\n\n      // Send the query for the first pattern to start the fun\n      batTreeCharacteristic.writeValueWithoutResponse(new TextEncoder().encode('GetPat 0\\n'));\n      currentPattern = 0;\n      BatState = BatMachine.gatherPatterns;\n    }\n\n    else if (BatState === BatMachine.gatherPatterns) {\n\n      console.log('Pattern ' + currentPattern + ': ' + respStr);\n      let localPatterns = this.state.allPatterns;\n\n      localPatterns.push({\n        name: respStr,\n        index: currentPattern\n      })\n      currentPattern++;\n\n      this.setState(() => {\n        return (\n          {\n            allPaterns: localPatterns\n          }\n        )\n      })\n\n      if (numPatterns > currentPattern) {\n        let queryString = 'GetPat ' + currentPattern + '\\n';\n        batTreeCharacteristic.writeValueWithoutResponse(new TextEncoder().encode(queryString));\n      }\n      else {\n        console.log('I have received all of my patterns?');\n        console.log(localPatterns);\n        BatState = BatMachine.queryNumAni;\n        batTreeCharacteristic.writeValueWithoutResponse(new TextEncoder().encode('NumAni\\n'));\n      }\n    }\n\n    else if (BatState === BatMachine.queryNumAni) {\n      numAnimations = parseInt(respStr);\n\n      if (numAnimations === 0) {\n        console.log('Same blah blah broken blah blah');\n        return;\n      }\n\n      // Send the query for the first animation to start the fun\n      batTreeCharacteristic.writeValueWithoutResponse(new TextEncoder().encode('GetAni 0\\n'));\n      BatState = BatMachine.gatherAnimations;\n    }\n\n    else if (BatState === BatMachine.gatherAnimations) {\n      console.log('Animation ' + currentAnimation + ': ' + respStr);\n      let localAnimations = this.state.allAnimations;\n      localAnimations.push({\n        name: respStr,\n        index: currentAnimation\n      })\n\n      currentAnimation++;\n\n      this.setState(() => {\n        return {\n          allAnimations: localAnimations\n        }\n      })\n\n      if (numAnimations > currentAnimation) {\n        let queryString = 'GetAni ' + currentAnimation + '\\n';\n        batTreeCharacteristic.writeValueWithoutResponse(new TextEncoder().encode(queryString));\n      }\n      else {\n        console.log('I have received all of my animations?');\n        console.log(localAnimations);\n\n        BatState = BatMachine.readyToRock;\n      }\n    }\n\n    else {\n      console.log(`Response: ${respStr}`);\n    }\n\n  }\n\n  makePatButton(data, idx) {\n    return (\n      <li key={data.name}>\n        <button id={'SetPat ' + idx} onClick={(e) => {\n          batTreeCharacteristic.writeValueWithoutResponse(new TextEncoder().encode(`${e.target.id}\\n`));\n          console.log(e.target.id)\n        }}>\n          {data.name}\n        </button>\n      </li>\n    );\n  }\n\n  makeAniButton(data, idx) {\n    return (\n      <li key={data.name}>\n        <button id={'SetAni ' + idx} onClick={(e) => {\n          batTreeCharacteristic.writeValueWithoutResponse(new TextEncoder().encode(`${e.target.id}\\n`));\n          console.log(e.target.id)\n        }}>\n            {data.name}\n        </button>\n      </li>\n    );\n  }\n\n\n  render() {\n    return (\n      <div className=\"App\">\n        <Header title='BAT Controller'/>\n        \n        {!this.state.connected &&\n          <button onClick={this.onClickConnect}>\n            Connect\n          </button>\n        }\n        <ul>\n          {this.state.allPatterns.map(this.makePatButton)}\n        </ul>\n        <ul>\n          {this.state.allAnimations.map(this.makeAniButton)}\n        </ul>\n        {this.state.connected && \n        <div>\n          <button onClick={() => {batTreeCharacteristic.writeValueWithoutResponse(new TextEncoder().encode(`IncBright\\n`))}}>IncBright</button>\n          <button onClick={() => {batTreeCharacteristic.writeValueWithoutResponse(new TextEncoder().encode(`DecBright\\n`))}}>DecBright</button>\n        </div>\n        }\n        {this.state.connected && \n        <div>\n          <button onClick={() => {batTreeCharacteristic.writeValueWithoutResponse(new TextEncoder().encode(`IncVol\\n`))}}>IncVol</button>\n          <button onClick={() => {batTreeCharacteristic.writeValueWithoutResponse(new TextEncoder().encode(`DecVol\\n`))}}>DecVol</button>\n        </div>\n        }\n      </div>\n    );\n  }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}